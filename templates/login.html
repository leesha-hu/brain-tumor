{% extends "base.html" %}

{% block header_buttons %}
  <a href="{{ url_for('home') }}" class="btn-secondary">Back to Home</a>
{% endblock %}

{% block title %}Login - TumorVision{% endblock %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='login.css') }}">

<div class="auth-wrapper">
  <div class="auth-card">
    <h2 class="auth-title">Login</h2>

    <form method="POST" class="form" id="login-form" novalidate>
      <label class="form-label">Username or Email
        <input name="username_or_email" required class="form-input"
               value="{{ request.form.get('username_or_email', '') }}" />
      </label>

      <label class="form-label">Password
        <input type="password" name="password" required class="form-input" />
      </label>

      <label class="form-label">Login as
        <select name="role" id="login-role" required class="form-select">
          <option value="" disabled selected>Select Role</option>
          <option value="patient" {% if request.form.get('role') == 'patient' %}selected{% endif %}>Patient</option>
          <option value="doctor" {% if request.form.get('role') == 'doctor' %}selected{% endif %}>Doctor</option>
        </select>
      </label>

      <button type="submit" class="auth-btn" id="login-submit" disabled>Login</button>
    </form>

    <p class="auth-foot">
      Don't have an account?
      <a href="{{ url_for('register') }}">Register here</a>
    </p>
  </div>
</div>

<script>
(function(){
  const roleSelect = document.getElementById('login-role');
  const submitBtn = document.getElementById('login-submit');
  const form = document.getElementById('login-form');

  function updateSubmitState() {
    submitBtn.disabled = (!roleSelect.value || roleSelect.value === '');
  }

  document.addEventListener('DOMContentLoaded', updateSubmitState);
  roleSelect.addEventListener('change', updateSubmitState);

  form.addEventListener('submit', function(e) {
    if (!roleSelect.value) {
      alert('Please select your role before logging in.');
      e.preventDefault();
      return;
    }
  });
})();
</script>
{% endblock %}
